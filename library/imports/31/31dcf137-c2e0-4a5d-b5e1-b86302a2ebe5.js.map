{"version":3,"sources":["assets\\Scripts\\ECS\\ECSFactory.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { ResManagerPro } from \"../../FrameWork/manager/ResManagerPro\";\nimport { util } from \"../../FrameWork/Utils/util\";\nimport DataManager from \"../data/DataManager\";\nimport MapDataManager from \"../Manager/MapDataManager\";\nimport BulletEntity from \"./Entities/BulletEntity\";\nimport CannonEntity from \"./Entities/CannonEntity\";\nimport MonsterEntity from \"./Entities/MonsterEntity\";\nimport { BulletState, UnitState } from \"../Enum\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ECSFactory extends cc.Component {\n\n    private static _instance:ECSFactory=null\n    public static getInstance():ECSFactory{\n        return ECSFactory._instance\n    }\n\n    onLoad () {\n        if(null===ECSFactory._instance){\n            ECSFactory._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n\n        let canvas=cc.find(\"Canvas\");\n        this.monsterNode=canvas.getChildByName(\"Game\").getChildByName(\"monsterNode\");\n        this.moveCannon=canvas.getChildByName(\"Game\").getChildByName(\"moveCannon\");\n        this.bulletBuild=canvas.getChildByName(\"Game\").getChildByName(\"bulletBuild\");\n    }\n\n    private monsterNode:cc.Node=null;\n    private moveCannon:cc.Node=null;\n    private bulletBuild:cc.Node=null;\n    private static entityID:number=0;\n\n    public async createMonsterEntity(type:number,index:number,list,hp,gold,speed){\n        let entity=new MonsterEntity();\n\n        let _pathPos = [];\n        for (let i = 0; i < list.length; i++) {\n            var x = list[i].x*106 + 106/2;\n            var y = -list[i].y*106 - 106/2 -35;\n            _pathPos.push(cc.v2(x,y));\n        }\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        let monsterPrefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"monster/msItem\",cc.Prefab) as cc.Prefab;\n        let node=cc.instantiate(monsterPrefab);\n        entity.baseComponent.gameObject=node;\n        this.monsterNode.addChild(node);\n\n        let monsterSpriteAtlas=await ResManagerPro.Instance.IE_GetAsset(\"texture\",\"monster/monster_\"+type,cc.SpriteAtlas) as cc.SpriteAtlas;\n        let right=entity.baseComponent.gameObject.getChildByName(\"item\").getChildByName(\"scale\").getChildByName(\"right\").getComponent(cc.Sprite)\n        let left=entity.baseComponent.gameObject.getChildByName(\"item\").getChildByName(\"scale\").getChildByName(\"left\").getComponent(cc.Sprite)\n        right.spriteFrame=monsterSpriteAtlas.getSpriteFrame(index.toString())\n        left.spriteFrame=monsterSpriteAtlas.getSpriteFrame(index.toString())\n\n        node.x=_pathPos[0].x;\n        node.y=_pathPos[0].y;\n\n        entity.transformComponent.x=_pathPos[0].x;\n        entity.transformComponent.y=_pathPos[0].y;\n\n        entity.navComponent.pathList=_pathPos;\n        entity.navComponent.speed=speed;\n\n        entity.attackComponent.hp=hp;\n        entity.attackComponent.maxHp=hp;\n        entity.attackComponent.gold=gold;\n\n        entity.roleComponent.type=type;\n        entity.roleComponent.index=index;\n\n        entity.shapeComponent.width=node.width;\n        entity.shapeComponent.height=node.height;\n\n        return entity;\n    }\n\n    public async createCannonEntity(idx:number,level:number){\n        let entity=new CannonEntity();\n\n        let cannonPrefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"cannon\",cc.Prefab) as cc.Prefab;\n        let node=cc.instantiate(cannonPrefab);\n        entity.baseComponent.gameObject=node;\n        this.moveCannon.addChild(node);\n\n        var lvData = DataManager.getInstance().cannonUpLevel[level];\n        \n        let gunPrefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"gun/gun_\"+lvData.type,cc.Prefab) as cc.Prefab;\n        let gunNode=cc.instantiate(gunPrefab);\n        node.getChildByName(\"gun\").addChild(gunNode);\n\n        let angle=util.randomNum(0,360);\n        node.getChildByName(\"gun\").angle=angle;\n\n        var index = Math.floor(lvData.level/3);\n        let name = ''+lvData.type+'_'+index;\n        let padSpriteAtlas=await ResManagerPro.Instance.IE_GetAsset(\"texture\",\"cannon/pad\",cc.SpriteAtlas) as cc.SpriteAtlas;\n        let frame = padSpriteAtlas.getSpriteFrame(name);\n        node.getChildByName(\"pad\").getComponent(cc.Sprite).spriteFrame = frame;\n        node.getChildByName(\"ui_towerLevel\").getChildByName(\"lv\").getComponent(cc.Label).string = ''+(lvData.level+1);\n\n        var startPos = cc.v2(317,-952);\n        node.setPosition(startPos);\n        var _cannonList = MapDataManager.getInstance().getCurCannonPoint();\n        var pos = _cannonList[idx];\n        var x = pos.x*106 + 106/2;\n        var y = -pos.y*106 - 106/2;\n        var endPos = cc.v2(x,y);\n\n        var moveTo = cc.moveTo(0.5,endPos);\n        var scaleTo1 = cc.scaleTo(0.2,4,4);\n        var delta = cc.delayTime(0.2);\n        var scaleTo2 = cc.scaleTo(0.1,1,1);\n        var seq = cc.sequence(scaleTo1,delta,scaleTo2,cc.callFunc(function(){\n            entity.unitComponent.state = UnitState.Active;\n        }.bind(this)));\n        var sp = cc.spawn(moveTo,seq);\n        node.runAction(sp);\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n\n        entity.transformComponent.x=x\n        entity.transformComponent.y=y\n\n        entity.unitComponent.angle=angle;\n        entity.unitComponent.state = UnitState.None;\n\n        entity.roleComponent.level=level;\n        entity.roleComponent.type=lvData.type;\n\n        entity.attackComponent.atk=lvData.atk;\n\n        return entity\n    }\n\n    public async createBulletEntity(level:number,worldPos:cc.Vec3,attackTarget:cc.Node,angle:number){\n        let entity=new BulletEntity();\n\n        var lvData = DataManager.getInstance().cannonUpLevel[level];\n        \n        let bulletPrefab=await ResManagerPro.Instance.IE_GetAsset(\"prefabs\",\"bullet/bullet_\"+lvData.type,cc.Prefab) as cc.Prefab;\n        let bulletNode=cc.instantiate(bulletPrefab);\n        this.bulletBuild.addChild(bulletNode);\n        let nodePos=this.bulletBuild.convertToNodeSpaceAR(worldPos);\n        bulletNode.setPosition(nodePos);\n        bulletNode.angle=angle;\n        if(2==lvData.type){\n            bulletNode.getChildByName(\"bullet\").angle = util.getAngle(nodePos, attackTarget.getPosition());\n        }\n\n        entity.baseComponent.entityID=ECSFactory.entityID++;\n        entity.baseComponent.gameObject=bulletNode;\n\n        entity.transformComponent.x=nodePos.x;\n        entity.transformComponent.y=nodePos.y;\n\n        entity.unitComponent.m_attackTarget=attackTarget;\n\n        entity.shapeComponent.width=bulletNode.width;\n        entity.shapeComponent.height=bulletNode.height;\n\n        entity.roleComponent.type=lvData.type;\n\n        entity.attackComponent.atk=lvData.atk;\n\n        entity.animateComponent.state=BulletState.Effect;\n        entity.animateComponent.playActionTime=0.25;\n\n        return entity;\n    }\n}\n"]}