{"version":3,"sources":["assets\\FrameWork\\manager\\TimerManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nclass TimerNode\n{\n    public func:Function=null\n    public params:any=null\n    public delay:number=0\n    public duration:number=0\n    public timerId:number=0\n    public totalTime:number=0\n    public isRemoved:boolean=false\n    public repeat:number=0\n}\n\nexport class TimerManager extends cc.Component {\n    public static _instance:TimerManager=null\n    public static getInstance():TimerManager{\n        return TimerManager._instance\n    }\n    private autoTimerId:number=0\n    private timers:any={}\n    private newAddTimerList:Array<TimerNode>=[]\n    private removedTimerList:Array<TimerNode>=[]\n\n    onLoad(){\n        if(null==TimerManager._instance){\n            TimerManager._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n    public ScheduleOnce(_func:Function,_delay:number):number{\n        return this.Schedule(_func,null,_delay,0,1)\n    }\n\n    public ShceduleOnce2(_func:Function,_params:any,_delay:number):number{\n        return this.Schedule(_func,_params,_delay,0,1)\n    }\n\n    public Schedule(_func:Function,_params:any,_delay:number,_duration:number,_repeat:number):number{\n        let node=new TimerNode()\n        node.func=_func\n        node.params=_params\n        node.delay=_delay\n        node.duration=_duration\n        node.timerId=this.autoTimerId++\n        node.totalTime=_duration\n        node.isRemoved=false\n        node.repeat=_repeat\n\n        this.newAddTimerList.push(node)\n\n        return node.timerId\n    }\n\n    public UnSchedule(timerId:number):void{\n        if(!this.timers[timerId]){\n            return\n        }\n\n        let node=this.timers[timerId] as TimerNode\n        node.isRemoved=true\n    }\n\n    update(deltaTime: number) {\n        for(let i=0;i<this.newAddTimerList.length;i++){\n            let node=this.newAddTimerList[i]\n            this.timers[node.timerId]=node\n        }\n        this.newAddTimerList.length=0\n\n        for(let k in this.timers){\n            let node=this.timers[k]\n            if(node.isRemoved){\n                this.removedTimerList.push(node)\n                continue\n            }\n\n            node.totalTime+=deltaTime\n            if(node.totalTime>=(node.delay+node.duration)){\n                node.func(node.params)\n                node.repeat--\n                node.totalTime-=(node.delay+node.duration)\n                node.delay=0\n\n                if(0==node.repeat){\n                    node.isRemoved=true\n                    this.removedTimerList.push(node)\n                }\n            }\n        }\n\n        for(let i=0;i<this.removedTimerList.length;i++){\n            let timerId=this.removedTimerList[i].timerId\n            delete this.timers[timerId]\n        }\n        this.removedTimerList.length=0\n    }\n}\n\n"]}