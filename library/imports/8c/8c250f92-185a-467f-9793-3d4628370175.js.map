{"version":3,"sources":["assets\\Scripts\\ECS\\ECSManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { GameStateType } from \"../Enum\";\nimport PlayerDataManager from \"../Manager/PlayerDataManager\";\nimport ECSFactory from \"./ECSFactory\";\nimport BulletEntity from \"./Entities/BulletEntity\";\nimport CannonEntity from \"./Entities/CannonEntity\";\nimport EffectEntity from \"./Entities/EffectEntity\";\nimport MonsterEntity from \"./Entities/MonsterEntity\";\nimport AISystem from \"./Systems/AISystem\";\nimport AnimateSystem from \"./Systems/AnimateSystem\";\nimport AttackSystem from \"./Systems/AttackSystem\";\nimport CollectHitSystem from \"./Systems/CollectHitSystem\";\nimport NavSystem from \"./Systems/NavSystem\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class ECSManager extends cc.Component {\n\n    private static _instance:ECSManager=null\n    public static getInstance():ECSManager{\n        return ECSManager._instance\n    }\n\n    onLoad () {\n        if(null===ECSManager._instance){\n            ECSManager._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    private monsters:Array<MonsterEntity>=[];\n    private cannones:Array<CannonEntity>=[];\n    private bullets:Array<BulletEntity>=[];\n    private effect:Array<EffectEntity>=[];\n\n    public async createMonsterEntity(type,index,list,hp,gold,speed){\n        let entity=await ECSFactory.getInstance().createMonsterEntity(type,index,list,hp,gold,speed);\n        this.monsters.push(entity);\n\n        return entity\n    }\n\n    public async createCannonEntity(index:number,level:number){\n        let entity=await ECSFactory.getInstance().createCannonEntity(index,level);\n        this.cannones.push(entity);\n\n        return entity\n    }\n\n    public async createBulletEntity(level:number,worldPos:cc.Vec3,attackEntity:MonsterEntity,angle:number){\n        let entity=await ECSFactory.getInstance().createBulletEntity(level,worldPos,attackEntity,angle);\n        this.bullets.push(entity);\n\n        return entity\n    }\n\n    public async createEffectEntity(worldPos:cc.Vec3){\n        let entity=await ECSFactory.getInstance().createEffectEntity(worldPos);\n        this.effect.push(entity);\n\n        return entity\n    }\n\n    public getMonsterById(entityID:number):MonsterEntity{\n        for(let i=0;i<this.monsters.length;i++){\n            if(entityID==this.monsters[i].baseComponent.entityID){\n                return this.monsters[i];\n            }\n        }\n\n        return null;\n    }\n\n    navSystemMonster(dt:number){\n        for(let i=0;i<this.monsters.length;i++){\n            NavSystem.getInstance().onUpdate(dt,this.monsters[i].navComponent,this.monsters[i].baseComponent,this.monsters[i].transformComponent);\n        }\n    }\n\n    animateSystemMonster(dt:number){\n        for(let i=0;i<this.monsters.length;i++){\n            AnimateSystem.getInstance().onMonsterUpdate(dt,this.monsters[i].baseComponent,this.monsters[i].roleComponent,this.monsters[i].animateComponent);\n        }\n    }\n\n    animateSystemBullet(dt:number){\n        for(let i=0;i<this.bullets.length;i++){\n            AnimateSystem.getInstance().onBulletUpdate(dt,this.bullets[i].baseComponent,this.bullets[i].animateComponent);\n        }\n    }\n\n    animateSystemEffect(dt:number){\n        for(let i=0;i<this.effect.length;i++){\n            AnimateSystem.getInstance().onEffectUpdate(dt,this.effect[i].baseComponent,this.effect[i].animateComponent,this.effect[i].unitComponent);\n        }\n    }\n\n    async attackSystemUpdate(dt:number){\n        for(let i=0;i<this.cannones.length;i++){\n            await AttackSystem.getInstance().onUpdate(dt,this.cannones[i].unitComponent,this.cannones[i].baseComponent,this.cannones[i].roleComponent,this.cannones[i].attackComponent);\n        }\n    }\n\n    AISystemBullet(dt:number){\n        for(let i=0;i<this.bullets.length;i++){\n            let monsterID=this.bullets[i].unitComponent.monsterID;\n            let monsterEntity=this.getMonsterById(monsterID);\n            AISystem.getInstance().onBulletUpdate(dt,monsterEntity,this.bullets[i].unitComponent,this.bullets[i].baseComponent,this.bullets[i].transformComponent,this.bullets[i].roleComponent,this.bullets[i].animateComponent);\n        }\n    }\n\n    collectHitSystemBullet(dt:number){\n        for(let i=0;i<this.bullets.length;i++){\n            let bullet=this.bullets[i];\n            let bulletTransformComponent=bullet.transformComponent;\n            let bulletUnitComponent=bullet.unitComponent;\n            let bulletShapeComponent=bullet.shapeComponent;\n            let monsterID=bullet.unitComponent.monsterID;\n            let monsterEntity=this.getMonsterById(monsterID);\n\n            if(bulletUnitComponent.isDead)continue;\n            if(null==monsterEntity){\n                bulletUnitComponent.isDead=true;\n                continue;\n            }\n\n            let monsterUnitComponent=monsterEntity.unitComponent;\n            let monsterBaseComponent=monsterEntity.baseComponent;\n            let monsterAttackComponent=monsterEntity.attackComponent;\n            let atk=bullet.attackComponent.atk;\n\n            let hitPos=cc.v2(monsterEntity.baseComponent.gameObject.x,monsterEntity.baseComponent.gameObject.y);\n            let isHit=CollectHitSystem.getInstance().onUpdate(atk,hitPos,bulletShapeComponent,bulletTransformComponent,bulletUnitComponent,monsterUnitComponent,monsterBaseComponent,monsterAttackComponent);\n            if(isHit){\n                bulletUnitComponent.isDead=true;\n            }\n        }\n    }\n\n    cleanDeadMonster(){\n        for(let i=0;i<this.monsters.length;i++){\n            if(this.monsters[i].unitComponent.isDead){\n                this.monsters[i].baseComponent.gameObject.destroy();\n                this.monsters.splice(i,1);\n                i--;\n            }\n        }\n    }\n\n    cleanDeadBullet(){\n        for(let i=0;i<this.bullets.length;i++){\n            if(this.bullets[i].unitComponent.isDead){\n                this.bullets[i].baseComponent.gameObject.destroy();\n                this.bullets.splice(i,1);\n                i--;\n            }\n        }\n    }\n\n    cleanDeadEffect(){\n        for(let i=0;i<this.effect.length;i++){\n            if(this.effect[i].unitComponent.isDead){\n                this.effect[i].baseComponent.gameObject.destroy();\n                this.effect.splice(i,1);\n                i--;\n            }\n        }\n    }\n\n    calcNearDistance(cannon):MonsterEntity{\n        var minDis = 9999;\n        var minMonster:MonsterEntity = null;\n        var curDis = 230;\n        \n        for (let i = 0; i < this.monsters.length; i++) {\n            let monster=this.monsters[i];\n            if( monster.unitComponent.isDead )continue;\n\n            let src=cc.v2(monster.baseComponent.gameObject.x,monster.baseComponent.gameObject.y);\n            let dst=cc.v2(cannon.x,cannon.y);\n            let dis=src.sub(dst).mag();\n            \n            if(dis < curDis && dis < Math.abs( minDis) ){\n                minDis = dis;\n                minMonster = monster;\n            }\n        }\n        //cc.log(minDis);\n        return minMonster;\n    }\n\n    protected async update(dt: number): Promise<void> {\n        if(GameStateType.Playing!=PlayerDataManager.getInstance().gameStateType){\n            return;\n        }\n        //怪物行走\n        this.navSystemMonster(dt);\n        //怪物动画\n        this.animateSystemMonster(dt);\n        //攻击\n        await this.attackSystemUpdate(dt);\n        //子弹动画\n        this.animateSystemBullet(dt);\n        //AI\n        this.AISystemBullet(dt);\n        //碰撞检测\n        this.collectHitSystemBullet(dt);\n        //特效动画\n        this.animateSystemEffect(dt);\n        //清理死亡怪物\n        this.cleanDeadMonster();\n        //清理死亡子弹\n        this.cleanDeadBullet();\n        //清理死亡特效\n        this.cleanDeadEffect();\n    }\n}\n"]}