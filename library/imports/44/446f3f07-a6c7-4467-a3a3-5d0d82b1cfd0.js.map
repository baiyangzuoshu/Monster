{"version":3,"sources":["assets\\Scripts\\demo\\ChatDemo.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["const { ccclass, property } = cc._decorator;\r\n\r\nimport UIBase from \"../../FrameWork/ui/UIBase\";\r\nimport EmojiParser from \"./EmojiParser\";\r\n\r\nclass Message {\r\n    public sender: string | null = null;\r\n    public senderIcon: string | null = null;\r\n    public msg: string | null = null;\r\n    public fromMe: boolean = false;\r\n}\r\n\r\n@ccclass\r\nexport default class ChatDemo extends UIBase {\r\n    private _list: fgui.GList = null!;\r\n    private _input: fgui.GTextInput = null!;\r\n    private _emojiSelectUI: fgui.GComponent = null!;\r\n    private _emojiParser: EmojiParser;\r\n    private _messages: Array<Message>;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this._messages = new Array<Message>();\r\n        this._emojiParser = new EmojiParser();\r\n    }\r\n\r\n    onLoad() {\r\n        this.loadMainGUI(\"Chat\",\"Main\");\r\n        this.guiMakeFullScreen();\r\n\r\n        this._list = this.getGUIChild(\"list\").asList;\r\n        this._list.setVirtual();\r\n        this._list.itemProvider = this.getListItemResource.bind(this);\r\n        this._list.itemRenderer = this.renderListItem.bind(this);\r\n\r\n        this._input = this.getGUIChild(\"input1\").asTextInput;\r\n        this._input.on(fgui.Event.Submit, this.onSubmit, this);\r\n\r\n        this.buttonAddClickEvent(\"btnSend1\",this.onClickSendBtn, this)\r\n        this.buttonAddClickEvent(\"btnEmoji1\",this.onClickEmojiBtn, this)\r\n\r\n        this._emojiSelectUI = this.createGUIObject(\"EmojiSelectUI\").asCom;\r\n        this._emojiSelectUI.getChild(\"list\").on(fgui.Event.CLICK_ITEM, this.onClickEmoji, this);\r\n    }\r\n\r\n    private addMsg(sender: string, senderIcon: string, msg: string, fromMe: boolean) {\r\n        let isScrollBottom: boolean = this._list.scrollPane.isBottomMost;\r\n\r\n        let newMessage = new Message();\r\n        newMessage.sender = sender;\r\n        newMessage.senderIcon = senderIcon;\r\n        newMessage.msg = msg;\r\n        newMessage.fromMe = fromMe;\r\n        this._messages.push(newMessage);\r\n\r\n        if (newMessage.fromMe) {\r\n            if (this._messages.length == 1 || Math.random() < 0.5) {\r\n                let replyMessage = new Message();\r\n                replyMessage.sender = \"FairyGUI\";\r\n                replyMessage.senderIcon = \"r1\";\r\n                replyMessage.msg = \"Today is a good day. [:gz]\";\r\n                replyMessage.fromMe = false;\r\n                this._messages.push(replyMessage);\r\n            }\r\n        }\r\n\r\n        if (this._messages.length > 100)\r\n            this._messages.splice(0, this._messages.length - 100);\r\n\r\n        this._list.numItems = this._messages.length;\r\n\r\n        if (isScrollBottom)\r\n            this._list.scrollPane.scrollBottom();\r\n    }\r\n\r\n    private getListItemResource(index: number): string {\r\n        let msg = this._messages[index];\r\n        if (msg.fromMe)\r\n            return \"ui://Chat/chatRight\";\r\n        else\r\n            return \"ui://Chat/chatLeft\";\r\n    }\r\n\r\n    private renderListItem(index: number, item: fgui.GButton): void {\r\n        let msg = this._messages[index];\r\n        if (!msg.fromMe)\r\n            item.getChild(\"name\").text = msg.sender;\r\n        let path=this.getGUIItemURL(msg.senderIcon!);\r\n        console.log(msg.senderIcon!,path)\r\n        item.icon = this.getGUIItemURL(msg.senderIcon!);\r\n        item.getChild(\"msg\").text = this._emojiParser.parse(msg.msg!);\r\n    }\r\n\r\n    private onClickSendBtn() {\r\n        let msg = this._input.text;\r\n        if (!msg)\r\n            return;\r\n\r\n        this.addMsg(\"Creator\", \"r0\", msg, true);\r\n        this._input.text = \"\";\r\n    }\r\n\r\n    private onClickEmojiBtn(evt: fgui.Event) {\r\n        fgui.GRoot.inst.showPopup(this._emojiSelectUI, evt.initiator, false);\r\n    }\r\n\r\n    private onClickEmoji(item: fgui.GObject) {\r\n        this._input.text += \"[:\" + item.text + \"]\";\r\n    }\r\n\r\n    private onSubmit() {\r\n        this.onClickSendBtn();\r\n    }\r\n}\r\n"]}