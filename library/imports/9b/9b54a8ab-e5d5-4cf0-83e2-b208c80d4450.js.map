{"version":3,"sources":["assets\\FrameWork\\manager\\ResManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AACA;IAAgC,8BAAY;IAA5C;QAAA,qEA6JC;QA5JW,gBAAU,GAAQ,CAAC,CAAA;QACnB,cAAQ,GAAQ,CAAC,CAAA;QACjB,cAAQ,GAAQ,CAAC,CAAA;QACjB,YAAM,GAAQ,CAAC,CAAA;QACf,WAAK,GAAU,IAAI,CAAA;QACnB,eAAS,GAAU,IAAI,CAAA;QACvB,aAAO,GAAK,EAAE,CAAA;;IAsJ1B,CAAC;IAnJiB,sBAAW,GAAzB;QACI,OAAO,UAAU,CAAC,QAAQ,CAAA;IAC9B,CAAC;IAED,2BAAM,GAAN;QACI,IAAG,UAAU,CAAC,QAAQ,IAAE,IAAI,EAAC;YACzB,UAAU,CAAC,QAAQ,GAAC,IAAI,CAAA;SAC3B;aACG;YACA,IAAI,CAAC,OAAO,EAAE,CAAA;SACjB;IACL,CAAC;IAED,oCAAe,GAAf,UAAgB,MAAa,EAAC,GAAU;QACpC,IAAI,MAAM,GAAwB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QACtD,IAAG,CAAC,MAAM,EAAC;YACP,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAC,MAAM,EAAC,GAAG,CAAC,CAAA;YAChD,OAAO,IAAI,CAAA;SACd;QAED,OAAO,MAAM,CAAA;IACjB,CAAC;IAED,mCAAc,GAAd,UAAe,MAAa,EAAC,GAAU;QACnC,IAAI,MAAM,GAAwB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QACtD,IAAG,CAAC,MAAM,EAAC;YACP,OAAO,CAAC,KAAK,CAAC,sBAAsB,EAAC,MAAM,EAAC,GAAG,CAAC,CAAA;YAChD,OAAO,IAAI,CAAA;SACd;QAED,OAAO,MAAM,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;IAC1B,CAAC;IACD,uCAAkB,GAAlB,UAAmB,MAAa;QAC5B,IAAI,MAAM,GAAwB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QACtD,IAAG,CAAC,MAAM,EAAC;YACP,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAC,MAAM,CAAC,CAAA;YAChD,OAAO,EAAE,CAAA;SACZ;QAED,IAAI,IAAI,GAAC,EAAE,CAAA;QACX,IAAI,KAAK,GAAC,MAAM,CAAC,cAAc,CAAC,GAAG,CAAC,CAAA;QACpC,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,KAAK,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;YAC3B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;SAC3B;QACD,OAAO,IAAI,CAAA;IACf,CAAC;IACD,QAAQ;IACR,MAAM;IACN,qBAAqB;IACrB,IAAI;IACJ,MAAM;IACN,aAAa;IACb,wCAAwC;IACxC,QAAQ;IACR,IAAI;IAEJ,6BAAQ,GAAR,UAAS,GAAO,EAAC,UAAmB,EAAC,MAAe;QAApD,iBA+BC;QA9BG,IAAI,CAAC,KAAK,GAAC,MAAM,CAAA;QACjB,IAAI,CAAC,SAAS,GAAC,UAAU,CAAA;QACzB,IAAI,CAAC,UAAU,GAAC,CAAC,CAAA;QACjB,IAAI,CAAC,QAAQ,GAAC,CAAC,CAAA;QACf,IAAI,CAAC,QAAQ,GAAC,CAAC,CAAA;QACf,IAAI,CAAC,MAAM,GAAC,CAAC,CAAA;QACb,KAAI,IAAI,MAAM,IAAI,GAAG,EAAC;YAClB,IAAI,CAAC,UAAU,EAAE,CAAA;YACjB,IAAG,GAAG,CAAC,MAAM,CAAC,YAAY,KAAK,EAAC;gBAC5B,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,GAAG,CAAC,MAAM,CAAC,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;oBACjC,IAAI,CAAC,QAAQ,IAAE,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,CAAA;iBAC5C;aACJ;SACJ;gCAEO,MAAM;YACV,OAAK,eAAe,CAAC,MAAM,EAAC,UAAC,GAAG,EAAC,MAAM;gBACnC,KAAI,CAAC,QAAQ,EAAE,CAAA;gBAEf,IAAG,CAAC,CAAC,GAAG,CAAC,MAAM,CAAC,YAAY,KAAK,CAAC,EAAC;oBAC/B,IAAI,KAAK,GAAC,MAAM,CAAC,cAAc,CAAC,GAAG,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAA;oBAChD,KAAI,CAAC,QAAQ,IAAE,KAAK,CAAC,MAAM,CAAA;oBAC3B,OAAO,CAAC,GAAG,CAAC,MAAM,EAAC,KAAK,EAAC,gBAAgB,EAAC,KAAI,CAAC,QAAQ,CAAC,CAAA;iBAC3D;gBAED,IAAG,KAAI,CAAC,QAAQ,IAAE,KAAI,CAAC,UAAU,EAAC;oBAC9B,KAAI,CAAC,eAAe,CAAC,GAAG,CAAC,CAAA;iBAC5B;YACL,CAAC,CAAC,CAAA;;;QAbN,KAAI,IAAI,MAAM,IAAI,GAAG;oBAAb,MAAM;SAcb;IACL,CAAC;IAED,oCAAe,GAAf,UAAgB,MAAa,EAAC,MAAe;QAA7C,iBAYC;QAXG,EAAE,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,EAAC,UAAC,GAAS,EAAC,MAA6B;YACtE,IAAG,GAAG,EAAC;gBACH,OAAO,CAAC,KAAK,CAAC,uBAAuB,EAAC,GAAG,CAAC,CAAA;gBAC1C,OAAM;aACT;YAED,KAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAC,MAAM,CAAA;YAC3B,IAAG,MAAM,EAAC;gBACN,MAAM,CAAC,GAAG,EAAC,MAAM,CAAC,CAAA;aACrB;QACN,CAAC,CAAC,CAAA;IACL,CAAC;IACD,oCAAe,GAAf,UAAgB,GAAO;QACnB,KAAI,IAAI,MAAM,IAAI,GAAG,EAAC;YAClB,IAAI,MAAM,GAAwB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;YACtD,IAAG,CAAC,MAAM,EAAC;gBACP,SAAQ;aACX;YAED,IAAG,GAAG,CAAC,MAAM,CAAC,YAAY,KAAK,EAAC;gBAC5B,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,GAAG,CAAC,MAAM,CAAC,CAAC,MAAM,EAAC,CAAC,EAAE,EACpC;oBACI,IAAI,CAAC,YAAY,CAAC,MAAM,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;iBACzE;aACJ;iBACG;gBACA,IAAI,SAAS,GAAC,GAAG,CAAC,MAAM,CAAC,CAAA;gBACzB,IAAI,KAAK,GAAC,MAAM,CAAC,cAAc,CAAC,GAAG,EAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAA;gBAEhD,IAAI,IAAI,GAAC,EAAE,CAAA;gBACX,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,KAAK,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;oBAC3B,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAA;iBAC3B;gBAED,IAAI,CAAC,YAAY,CAAC,MAAM,EAAC,SAAS,EAAC,IAAI,CAAC,CAAA;aAC3C;SACJ;IACL,CAAC;IAED,iCAAY,GAAZ,UAAa,MAAa,EAAC,SAAa,EAAC,IAAa;QAAtD,iBAiBC;QAhBG,IAAI,MAAM,GAAwB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;QACtD,KAAI,IAAI,CAAC,GAAC,CAAC,EAAC,CAAC,GAAC,IAAI,CAAC,MAAM,EAAC,CAAC,EAAE,EAAC;YAC1B,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,EAAC,SAAS,EAAC,UAAC,GAAS,EAAC,IAAa;gBAClD,IAAG,GAAG,EAAC;oBACH,OAAO,CAAC,KAAK,CAAC,qBAAqB,EAAC,GAAG,CAAC,CAAA;oBACxC,OAAM;iBACT;gBAED,KAAI,CAAC,MAAM,EAAE,CAAA;gBAEb,KAAI,CAAC,SAAS,CAAC,KAAI,CAAC,MAAM,EAAC,KAAI,CAAC,QAAQ,CAAC,CAAA;gBACzC,IAAG,KAAI,CAAC,MAAM,IAAE,KAAI,CAAC,QAAQ,EAAC;oBAC1B,KAAI,CAAC,KAAK,EAAE,CAAA;iBACf;YACL,CAAC,CAAC,CAAA;SACL;IACL,CAAC;IAnJa,mBAAQ,GAAY,IAAI,CAAA;IAoJ1C,iBAAC;CA7JD,AA6JC,CA7J+B,EAAE,CAAC,SAAS,GA6J3C;AA7JY,gCAAU","file":"","sourceRoot":"/","sourcesContent":["\r\nexport class ResManager extends cc.Component {\r\n    private totalAsset:number=0\r\n    private curAsset:number=0\r\n    private totalRes:number=0\r\n    private curRes:number=0\r\n    private endCb:Function=null\r\n    private processCb:Function=null\r\n    private bundles:any={}\r\n\r\n    public static _istance:ResManager=null\r\n    public static getInstance():ResManager{\r\n        return ResManager._istance\r\n    }\r\n\r\n    onLoad(){\r\n        if(ResManager._istance==null){\r\n            ResManager._istance=this\r\n        }\r\n        else{\r\n            this.destroy()\r\n        }\r\n    }\r\n\r\n    getBundleByName(abName:string,url:string):cc.AssetManager.Bundle{\r\n        let bundle:cc.AssetManager.Bundle=this.bundles[abName]\r\n        if(!bundle){\r\n            console.error(\"getAssetByName error\",abName,url)\r\n            return null\r\n        }\r\n\r\n        return bundle\r\n    }\r\n\r\n    getAssetByName(abName:string,url:string):cc.Asset{\r\n        let bundle:cc.AssetManager.Bundle=this.bundles[abName]\r\n        if(!bundle){\r\n            console.error(\"getAssetByName error\",abName,url)\r\n            return null\r\n        }\r\n\r\n        return bundle.get(url)\r\n    }\r\n    getAssetUrlsByName(abName:string):Array<string>{\r\n        let bundle:cc.AssetManager.Bundle=this.bundles[abName]\r\n        if(!bundle){\r\n            console.error(\"getAssetUrlsByName error\",abName)\r\n            return []\r\n        }\r\n\r\n        let urls=[]\r\n        let infos=bundle.getDirWithPath(\"/\")\r\n        for(let i=0;i<infos.length;i++){\r\n            urls.push(infos[i].path)\r\n        }\r\n        return urls\r\n    }\r\n    // pkg格式\r\n    // 1.{\r\n    //     data:assetType\r\n    // }\r\n    // 2.{\r\n    //     data:[\r\n    //         {assetType:TextAsset,urls:[]}\r\n    //     ]\r\n    // }\r\n\r\n    parsePkg(pkg:any,_processCb:Function,_endCb:Function):void{\r\n        this.endCb=_endCb\r\n        this.processCb=_processCb\r\n        this.totalAsset=0\r\n        this.totalRes=0\r\n        this.curAsset=0\r\n        this.curRes=0\r\n        for(let abName in pkg){\r\n            this.totalAsset++\r\n            if(pkg[abName] instanceof Array){\r\n                for(let i=0;i<pkg[abName].length;i++){\r\n                    this.totalRes+=pkg[abName][i].urls.length\r\n                }\r\n            }\r\n        }\r\n        \r\n        for(let abName in pkg){\r\n            this.loadAssetBundle(abName,(err,bundle)=>{\r\n                this.curAsset++\r\n\r\n                if(!(pkg[abName] instanceof Array)){\r\n                    let infos=bundle.getDirWithPath(\"/\",pkg[abName])\r\n                    this.totalRes+=infos.length\r\n                    console.log(abName,infos,\"this.totalRes=\",this.totalRes)\r\n                }\r\n                \r\n                if(this.curAsset>=this.totalAsset){\r\n                    this.preloadAssetRes(pkg)\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    loadAssetBundle(abName:string,_endCb:Function):void{\r\n        cc.assetManager.loadBundle(abName,(err:Error,bundle:cc.AssetManager.Bundle)=>{\r\n            if(err){\r\n                console.error(\"loadAssetBundle error\",err)\r\n                return\r\n            }\r\n\r\n            this.bundles[abName]=bundle\r\n            if(_endCb){\r\n                _endCb(err,bundle)\r\n            }\r\n       }) \r\n    }\r\n    preloadAssetRes(pkg:any):void{\r\n        for(let abName in pkg){\r\n            let bundle:cc.AssetManager.Bundle=this.bundles[abName]\r\n            if(!bundle){\r\n                continue\r\n            }\r\n\r\n            if(pkg[abName] instanceof Array){\r\n                for(let i=0;i<pkg[abName].length;i++)\r\n                {\r\n                    this.loadAssetRes(abName,pkg[abName][i].assetType,pkg[abName][i].urls)\r\n                }\r\n            }\r\n            else{\r\n                let assetType=pkg[abName]\r\n                let infos=bundle.getDirWithPath(\"/\",pkg[abName])\r\n\r\n                let urls=[]\r\n                for(let i=0;i<infos.length;i++){\r\n                    urls.push(infos[i].path)\r\n                }\r\n\r\n                this.loadAssetRes(abName,assetType,urls)\r\n            }\r\n        }\r\n    }\r\n\r\n    loadAssetRes(abName:string,assetType:any,urls:string[]):void{\r\n        let bundle:cc.AssetManager.Bundle=this.bundles[abName]\r\n        for(let k=0;k<urls.length;k++){\r\n            bundle.load(urls[k],assetType,(err:Error,data:cc.Asset)=>{\r\n                if(err){\r\n                    console.error(\"loadAssetRes error=\",err)\r\n                    return\r\n                }\r\n                \r\n                this.curRes++\r\n\r\n                this.processCb(this.curRes,this.totalRes)\r\n                if(this.curRes==this.totalRes){\r\n                    this.endCb()\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\n"]}