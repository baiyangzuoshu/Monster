{"version":3,"sources":["assets\\Scripts\\demo\\JoystickModule.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AACA;IAA4C,kCAAc;IAoBtD,wBAAmB,QAAyB;QAA5C,YACI,iBAAO,SAkBV;QApCO,kBAAY,GAAW,CAAC,CAAC;QACzB,kBAAY,GAAW,CAAC,CAAC;QACzB,iBAAW,GAAW,CAAC,CAAC;QACxB,iBAAW,GAAW,CAAC,CAAC;QAMxB,cAAQ,GAAyB,IAAI,CAAC;QAW1C,KAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,QAAQ,CAAC;QACtD,KAAI,CAAC,OAAO,CAAC,kBAAkB,GAAG,KAAK,CAAC;QACxC,KAAI,CAAC,MAAM,GAAG,KAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;QAC7C,KAAI,CAAC,UAAU,GAAG,QAAQ,CAAC,QAAQ,CAAC,gBAAgB,CAAC,CAAC;QACtD,KAAI,CAAC,OAAO,GAAG,QAAQ,CAAC,QAAQ,CAAC,iBAAiB,CAAC,CAAC;QAEpD,KAAI,CAAC,MAAM,GAAG,KAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;QACtD,KAAI,CAAC,MAAM,GAAG,KAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;QACvD,KAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;QACnB,KAAI,CAAC,MAAM,GAAG,GAAG,CAAC;QAElB,KAAI,CAAC,OAAO,GAAG,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QAE7B,KAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,KAAI,CAAC,WAAW,EAAE,KAAI,CAAC,CAAC;QACnE,KAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,EAAE,KAAI,CAAC,WAAW,EAAE,KAAI,CAAC,CAAC;QAClE,KAAI,CAAC,UAAU,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,KAAI,CAAC,UAAU,EAAE,KAAI,CAAC,CAAC;;IACpE,CAAC;IAEM,gCAAO,GAAd,UAAe,GAAe;QAC1B,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IAC1B,CAAC;IAEO,oCAAW,GAAnB,UAAoB,GAAe;QAC/B,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,EAAE,EAAC,aAAa;YACnC,IAAI,CAAC,QAAQ,GAAG,GAAG,CAAC,OAAO,CAAC;YAE5B,IAAI,IAAI,CAAC,QAAQ,EAAE;gBACf,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;gBACrB,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;aACxB;YAED,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;YAClE,IAAI,EAAE,GAAW,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAChC,IAAI,EAAE,GAAW,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI,CAAC;YAE7B,IAAI,EAAE,GAAG,CAAC;gBACN,EAAE,GAAG,CAAC,CAAC;iBACN,IAAI,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK;gBAC/B,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC;YAE/B,IAAI,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM;gBAC3B,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC;iBAC3B,IAAI,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC3B,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YAE3B,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;YACtB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;YACtB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YACvB,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC;YAEvB,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;YAC5B,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;YAC7C,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;YAC9C,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;YAC7C,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;YAE9C,IAAI,MAAM,GAAW,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC;YACtC,IAAI,MAAM,GAAW,EAAE,GAAG,IAAI,CAAC,MAAM,CAAC;YACtC,IAAI,OAAO,GAAW,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE,MAAM,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC;YACjE,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,OAAO,GAAG,EAAE,CAAC;YAEpC,GAAG,CAAC,YAAY,EAAE,CAAC;SACtB;IACL,CAAC;IAEO,oCAAW,GAAnB,UAAoB,GAAe;QAC/B,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;YACrD,IAAI,EAAE,GAAW,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAC3B,IAAI,EAAE,GAAW,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAC3B,IAAI,KAAK,GAAW,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC;YAC1C,IAAI,KAAK,GAAW,EAAE,GAAG,IAAI,CAAC,WAAW,CAAC;YAC1C,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;YACtB,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC;YACtB,IAAI,OAAO,GAAW,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK,CAAC;YAC7C,IAAI,OAAO,GAAW,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,KAAK,CAAC;YAE7C,IAAI,OAAO,GAAW,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC;YAC3E,IAAI,OAAO,GAAW,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC;YAE5E,IAAI,GAAG,GAAW,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;YAC/C,IAAI,MAAM,GAAW,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC;YACzC,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,MAAM,GAAG,EAAE,CAAC;YAEnC,IAAI,IAAI,GAAW,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAC/C,IAAI,IAAI,GAAW,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YAC/C,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;gBAClC,OAAO,GAAG,IAAI,CAAC;YACnB,IAAI,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC;gBAClC,OAAO,GAAG,IAAI,CAAC;YAEnB,OAAO,GAAG,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC;YACtC,OAAO,GAAG,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC;YACtC,IAAI,OAAO,GAAG,CAAC;gBACX,OAAO,GAAG,CAAC,CAAC;YAChB,IAAI,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM;gBAChC,OAAO,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC;YAErC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;YAClD,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;YAEnD,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC;SACpD;IACL,CAAC;IAEO,mCAAU,GAAlB,UAAmB,GAAe;QAC9B,IAAI,IAAI,CAAC,QAAQ,IAAI,CAAC,CAAC,IAAI,GAAG,CAAC,OAAO,IAAI,IAAI,CAAC,QAAQ,EAAE;YACrD,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;YACnB,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,GAAG,CAAC;YAClD,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC;YAC7B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,GAAG,CAAC;iBAC5I,SAAS,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC;iBACjD,OAAO,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;iBAC9B,UAAU,CAAC,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;YAE5C,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;SACxC;IACL,CAAC;IAEO,wCAAe,GAAvB;QACI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrB,IAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,KAAK,CAAC;QAC9B,IAAI,CAAC,MAAM,CAAC,QAAQ,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,OAAO,CAAC,OAAO,GAAG,IAAI,CAAC;QAC5B,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,CAAC,CAAC;QACtD,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC;IAC3D,CAAC;IAtIa,6BAAc,GAAW,gBAAgB,CAAC;IAC1C,yBAAU,GAAW,YAAY,CAAC;IAsIpD,qBAAC;CAtJD,AAsJC,CAtJ2C,EAAE,CAAC,WAAW,GAsJzD;kBAtJoB,cAAc","file":"","sourceRoot":"/","sourcesContent":["\r\nexport default class JoystickModule extends cc.EventTarget {\r\n    private _InitX: number;\r\n    private _InitY: number;\r\n    private _startStageX: number = 0;\r\n    private _startStageY: number = 0;\r\n    private _lastStageX: number = 0;\r\n    private _lastStageY: number = 0;\r\n    private _button: fgui.GButton;\r\n    private _touchArea: fgui.GObject;\r\n    private _thumb: fgui.GObject;\r\n    private _center: fgui.GObject;\r\n    private _touchId: number;\r\n    private _tweener: fgui.GTweener | null = null;\r\n    private _curPos: cc.Vec2;\r\n\r\n    public static JoystickMoving: string = \"JoystickMoving\";\r\n    public static JoystickUp: string = \"JoystickUp\";\r\n\r\n    public radius: number;\r\n\r\n    public constructor(mainView: fgui.GComponent) {\r\n        super();\r\n\r\n        this._button = mainView.getChild(\"joystick\").asButton;\r\n        this._button.changeStateOnClick = false;\r\n        this._thumb = this._button.getChild(\"thumb\");\r\n        this._touchArea = mainView.getChild(\"joystick_touch\");\r\n        this._center = mainView.getChild(\"joystick_center\");\r\n\r\n        this._InitX = this._center.x + this._center.width / 2;\r\n        this._InitY = this._center.y + this._center.height / 2;\r\n        this._touchId = -1;\r\n        this.radius = 150;\r\n\r\n        this._curPos = new cc.Vec2();\r\n\r\n        this._touchArea.on(fgui.Event.TOUCH_BEGIN, this.onTouchDown, this);\r\n        this._touchArea.on(fgui.Event.TOUCH_MOVE, this.onTouchMove, this);\r\n        this._touchArea.on(fgui.Event.TOUCH_END, this.onTouchEnd, this);\r\n    }\r\n\r\n    public trigger(evt: fgui.Event): void {\r\n        this.onTouchDown(evt);\r\n    }\r\n\r\n    private onTouchDown(evt: fgui.Event) {\r\n        if (this._touchId == -1) {//First touch\r\n            this._touchId = evt.touchId;\r\n\r\n            if (this._tweener) {\r\n                this._tweener.kill();\r\n                this._tweener = null;\r\n            }\r\n\r\n            fgui.GRoot.inst.globalToLocal(evt.pos.x, evt.pos.y, this._curPos);\r\n            var bx: number = this._curPos.x;\r\n            var by: number = this._curPos.y;\r\n            this._button.selected = true;\r\n\r\n            if (bx < 0)\r\n                bx = 0;\r\n            else if (bx > this._touchArea.width)\r\n                bx = this._touchArea.width;\r\n\r\n            if (by > fgui.GRoot.inst.height)\r\n                by = fgui.GRoot.inst.height;\r\n            else if (by < this._touchArea.y)\r\n                by = this._touchArea.y;\r\n\r\n            this._lastStageX = bx;\r\n            this._lastStageY = by;\r\n            this._startStageX = bx;\r\n            this._startStageY = by;\r\n\r\n            this._center.visible = true;\r\n            this._center.x = bx - this._center.width / 2;\r\n            this._center.y = by - this._center.height / 2;\r\n            this._button.x = bx - this._button.width / 2;\r\n            this._button.y = by - this._button.height / 2;\r\n\r\n            var deltaX: number = bx - this._InitX;\r\n            var deltaY: number = by - this._InitY;\r\n            var degrees: number = Math.atan2(deltaY, deltaX) * 180 / Math.PI;\r\n            this._thumb.rotation = degrees + 90;\r\n\r\n            evt.captureTouch();\r\n        }\r\n    }\r\n\r\n    private onTouchMove(evt: fgui.Event): void {\r\n        if (this._touchId != -1 && evt.touchId == this._touchId) {\r\n            var bx: number = evt.pos.x;\r\n            var by: number = evt.pos.y;\r\n            var moveX: number = bx - this._lastStageX;\r\n            var moveY: number = by - this._lastStageY;\r\n            this._lastStageX = bx;\r\n            this._lastStageY = by;\r\n            var buttonX: number = this._button.x + moveX;\r\n            var buttonY: number = this._button.y + moveY;\r\n\r\n            var offsetX: number = buttonX + this._button.width / 2 - this._startStageX;\r\n            var offsetY: number = buttonY + this._button.height / 2 - this._startStageY;\r\n\r\n            var rad: number = Math.atan2(offsetY, offsetX);\r\n            var degree: number = rad * 180 / Math.PI;\r\n            this._thumb.rotation = degree + 90;\r\n\r\n            var maxX: number = this.radius * Math.cos(rad);\r\n            var maxY: number = this.radius * Math.sin(rad);\r\n            if (Math.abs(offsetX) > Math.abs(maxX))\r\n                offsetX = maxX;\r\n            if (Math.abs(offsetY) > Math.abs(maxY))\r\n                offsetY = maxY;\r\n\r\n            buttonX = this._startStageX + offsetX;\r\n            buttonY = this._startStageY + offsetY;\r\n            if (buttonX < 0)\r\n                buttonX = 0;\r\n            if (buttonY > fgui.GRoot.inst.height)\r\n                buttonY = fgui.GRoot.inst.height;\r\n\r\n            this._button.x = buttonX - this._button.width / 2;\r\n            this._button.y = buttonY - this._button.height / 2;\r\n\r\n            this.emit(JoystickModule.JoystickMoving, degree);\r\n        }\r\n    }\r\n\r\n    private onTouchEnd(evt: fgui.Event): void {\r\n        if (this._touchId != -1 && evt.touchId == this._touchId) {\r\n            this._touchId = -1;\r\n            this._thumb.rotation = this._thumb.rotation + 180;\r\n            this._center.visible = false;\r\n            this._tweener = fgui.GTween.to2(this._button.x, this._button.y, this._InitX - this._button.width / 2, this._InitY - this._button.height / 2, 0.3)\r\n                .setTarget(this._button, this._button.setPosition)\r\n                .setEase(fgui.EaseType.CircOut)\r\n                .onComplete(this.onTweenComplete, this);\r\n\r\n            this.emit(JoystickModule.JoystickUp);\r\n        }\r\n    }\r\n\r\n    private onTweenComplete(): void {\r\n        this._tweener = null;\r\n        this._button.selected = false;\r\n        this._thumb.rotation = 0;\r\n        this._center.visible = true;\r\n        this._center.x = this._InitX - this._center.width / 2;\r\n        this._center.y = this._InitY - this._center.height / 2;\r\n    }\r\n}\r\n"]}