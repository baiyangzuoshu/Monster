{"version":3,"sources":["assets\\FrameWork\\manager\\ResManagerPro.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["\nexport class ResManagerPro extends cc.Component {\n    public static Instance: ResManagerPro = null!;\n\n    protected onLoad(): void {\n        if(ResManagerPro.Instance !== null) {\n            this.destroy();\n            return;\n        }\n\n        ResManagerPro.Instance = this;\n    }\n\n    private async IE_LoadBundle(bundleName: string) {\n        return new Promise((resolve, reject)=>{\n            cc.assetManager.loadBundle(bundleName, (err, bundleData)=>{\n                if(err) {\n                    console.log(err);\n                    reject(null);\n                    return;\n                }\n                else {\n                    resolve(bundleData);\n                    return;\n                }\n            })\n        });\n    }\n\n    public async Init() {\n        // 测试代码\n        // cc.assetManager.loadBundle(\"Scenes\", (err, bundle: cc.AssetManager.Bundle)=>{\n        //     if(err) {\n        //         console.log(err);\n        //         return;\n        //     }\n\n        //     console.log(bundle);\n        //     var infos = bundle.getDirWithPath(\"\", cc.SceneAsset);\n        //     console.log(infos)\n        // });\n\n        // var bundle = await this.IE_LoadBundle(\"Sounds\"); \n        // console.log(bundle);\n\n        // var textData: cc.TextAsset = await this.IE_GetAsset(\"data\", \"map\", cc.TextAsset) as any; \n        // console.log(textData.text);\n    }\n\n    private async IE_LoadAllAssetsInBundle(bundle: cc.AssetManager.Bundle, assetType) {\n        return new Promise((resolve, reject)=>{\n            bundle.loadDir(\"\", assetType as any, (err, infos)=>{\n                if(err) {\n                    reject(err);\n                    return;\n                }\n                else {\n                    resolve(infos);\n                }\n            });\n        });\n    }\n\n    private async IE_LoadAssetInBundle(bundle: cc.AssetManager.Bundle, assetName: string, assetType) {\n        return new Promise((resolve, reject)=>{\n            bundle.load(assetName, assetType, (err, assetData)=>{\n                if(err) {\n                    reject(err);\n                    return;\n                }\n                else {\n                    resolve(assetData);\n                }\n            });\n        });\n    }\n\n    private async IE_LoadSceneInBundle(bundle: cc.AssetManager.Bundle, sceneName: string) {\n        return new Promise((resolve, reject)=>{\n            bundle.loadScene(sceneName, (err, sceneData)=>{\n                if(err) {\n                    reject(err);\n                    return;\n                }\n                else {\n                    resolve(sceneData);\n                    return;\n                }\n            });\n        });\n    }\n\n    public async IE_LoadBundleAndAllAssets(bundleName: string, assetType) {\n        var bundle: cc.AssetManager.Bundle = await this.IE_LoadBundle(bundleName) as cc.AssetManager.Bundle; \n        if(bundle === null) {\n            return null;\n        }\n\n        await this.IE_LoadAllAssetsInBundle(bundle, assetType);\n    }\n\n    public async IE_GetScene(bundleName: string, scenePath: string) {\n        var bundle: cc.AssetManager.Bundle = cc.assetManager.getBundle(bundleName);\n        \n        if(bundle === null) {\n            bundle = await this.IE_LoadBundle(bundleName) as any;\n            if(bundle === null) {\n                console.log(\"bundle load err: \" + bundleName);\n                return;\n            }\n        }\n        \n        var sceneData = await this.IE_LoadSceneInBundle(bundle, scenePath) as any;\n        return sceneData;\n    }\n\n    public async IE_GetAsset(bundleName: string, assetPath: string, assetType) {\n        var bundle: cc.AssetManager.Bundle = cc.assetManager.getBundle(bundleName);\n        if(bundle === null) {\n            bundle = await this.IE_LoadBundle(bundleName) as any;\n            if(bundle === null) {\n                console.log(\"bundle load err: \" + bundleName);\n                return;\n            }\n        }\n        \n        var assetData = bundle.get(assetPath,assetType);\n        if(assetData) {\n            return assetData; \n        }\n\n        assetData = await this.IE_LoadAssetInBundle(bundle, assetPath, assetType) as any;\n        return assetData;\n    }\n\n    public ReleaseAsset(assetData: cc.Asset): void {\n        cc.assetManager.releaseAsset(assetData);\n    }\n\n    public ReleaseAllAssetInBundle(bundleName): void {\n        var bundle: cc.AssetManager.Bundle = cc.assetManager.getBundle(bundleName);\n        if(bundle === null) {\n            return;\n        }\n\n        bundle.releaseAll();\n\n        cc.assetManager.removeBundle(bundle);\n    }\n}\n\n\n"]}