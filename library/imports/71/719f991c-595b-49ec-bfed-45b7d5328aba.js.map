{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\NavSystem.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,4EAA4E;AAC5E,mBAAmB;AACnB,sFAAsF;AACtF,8BAA8B;AAC9B,sFAAsF;;;;;;;;;;;;;;;;;;;;;AAEtF,wEAAuE;AACvE,mCAA2C;AAC3C,6CAAyC;AACzC,qEAAgE;AAIhE,8CAAyC;AAEnC,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAuC,6BAAY;IAAnD;;IAgDA,CAAC;kBAhDoB,SAAS;IAEZ,qBAAW,GAAzB;QACI,OAAO,WAAS,CAAC,SAAS,CAAA;IAC9B,CAAC;IAED,0BAAM,GAAN;QACI,IAAG,IAAI,KAAG,WAAS,CAAC,SAAS,EAAC;YAC1B,WAAS,CAAC,SAAS,GAAC,IAAI,CAAA;SAC3B;aACG;YACA,IAAI,CAAC,OAAO,EAAE,CAAA;YACd,OAAM;SACT;IACL,CAAC;IAEM,4BAAQ,GAAf,UAAgB,EAAS,EAAC,YAAyB,EAAC,aAA2B,EAAC,kBAAqC;QACjH,IAAG,YAAY,CAAC,OAAO,GAAC,CAAC,EAAC;YACtB,YAAY,CAAC,OAAO,IAAE,EAAE,CAAA;YACxB,kBAAkB,CAAC,CAAC,IAAE,EAAE,GAAC,YAAY,CAAC,EAAE,CAAC;YACzC,kBAAkB,CAAC,CAAC,IAAE,EAAE,GAAC,YAAY,CAAC,EAAE,CAAC;YAEzC,aAAa,CAAC,UAAU,CAAC,CAAC,GAAC,kBAAkB,CAAC,CAAC,CAAC;YAChD,aAAa,CAAC,UAAU,CAAC,CAAC,GAAC,kBAAkB,CAAC,CAAC,CAAC;YAEhD,OAAM;SACT;QAED,YAAY,CAAC,QAAQ,EAAE,CAAC;QACxB,IAAG,YAAY,CAAC,QAAQ,CAAC,MAAM,GAAC,CAAC,GAAC,YAAY,CAAC,QAAQ,EAAC;YACpD,2BAAiB,CAAC,WAAW,EAAE,CAAC,aAAa,GAAC,oBAAa,CAAC,GAAG,CAAC;YAChE,2BAAY,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,kBAAM,CAAC,QAAQ,CAAC,CAAC;YACjD,OAAM;SACT;QAED,IAAI,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,kBAAkB,CAAC,CAAC,EAAC,kBAAkB,CAAC,CAAC,EAAC,CAAC,CAAC,CAAA;QAC5D,IAAI,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,YAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,YAAY,CAAC,QAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACnH,IAAI,GAAG,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC;QAClB,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAChC,IAAI,GAAG,GAAG,GAAG,CAAC,GAAG,EAAE,CAAA;QAEnB,qBAAW,CAAC,WAAW,EAAE,CAAC,sBAAsB,CAAC,GAAG,EAAC,GAAG,EAAC,aAAa,CAAC,CAAC;QAExE,YAAY,CAAC,OAAO,GAAG,GAAG,GAAG,YAAY,CAAC,KAAK,CAAC;QAEhD,YAAY,CAAC,EAAE,GAAG,YAAY,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;QACnD,YAAY,CAAC,EAAE,GAAG,YAAY,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;IACvD,CAAC;;IA9Cc,mBAAS,GAAW,IAAI,CAAA;IADtB,SAAS;QAD7B,OAAO;OACa,SAAS,CAgD7B;IAAD,gBAAC;CAhDD,AAgDC,CAhDsC,EAAE,CAAC,SAAS,GAgDlD;kBAhDoB,SAAS","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { EventManager } from \"../../../FrameWork/manager/EventManager\";\nimport { GameStateType } from \"../../Enum\";\nimport { GameUI } from \"../../EventName\";\nimport PlayerDataManager from \"../../Manager/PlayerDataManager\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport NavComponent from \"../Components/NavComponent\";\nimport TransformComponent from \"../Components/TransformComponent\";\nimport EntityUtils from \"../EntityUtils\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class NavSystem extends cc.Component {\n    private static _instance:NavSystem=null\n    public static getInstance():NavSystem{\n        return NavSystem._instance\n    }\n\n    onLoad () {\n        if(null===NavSystem._instance){\n            NavSystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    public onUpdate(dt:number,navComponent:NavComponent,baseComponent:BaseComponent,transformComponent:TransformComponent) {\n        if(navComponent.curTime>0){\n            navComponent.curTime-=dt\n            transformComponent.x+=dt*navComponent.vx;\n            transformComponent.y+=dt*navComponent.vy;\n\n            baseComponent.gameObject.x=transformComponent.x;\n            baseComponent.gameObject.y=transformComponent.y;\n\n            return\n        }\n\n        navComponent.curIndex++;\n        if(navComponent.pathList.length-1<navComponent.curIndex){\n            PlayerDataManager.getInstance().gameStateType=GameStateType.End;\n            EventManager.getInstance().emit(GameUI.gameOver);\n            return\n        }\n\n        var src = cc.v3(transformComponent.x,transformComponent.y,0)\n        var dst = cc.v3(navComponent.pathList[navComponent.curIndex].x, navComponent.pathList[navComponent.curIndex].y, 0);\n        var dir = cc.v3();\n        cc.Vec3.subtract(dir, dst, src);\n        var dis = dir.len()\n\n        EntityUtils.getInstance().updateMonsterDirection(src,dst,baseComponent);\n\n        navComponent.curTime = dis / navComponent.speed;\n\n        navComponent.vx = navComponent.speed * dir.x / dis;\n        navComponent.vy = navComponent.speed * dir.y / dis;\n    }\n}\n"]}