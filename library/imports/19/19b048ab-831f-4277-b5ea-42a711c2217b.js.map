{"version":3,"sources":["assets\\Scripts\\Manager\\MapDataManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { ResManagerPro } from \"../../FrameWork/manager/ResManagerPro\";\nimport DataManager from \"../data/DataManager\";\nimport ECSManager from \"../ECS/ECSManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class MapDataManager extends cc.Component {\n    \n    private cannonList:Array<any>=null;\n    private mapBlockData:Array<any>=null;\n    private pathList:Array<any>=null;\n    private startPos:Array<cc.Vec2>=[];\n    private m_mapBlockItem:Array<any>=[];\n    private blockMaps:cc.Node=null;\n\n    private static _instance:MapDataManager=null\n    public static getInstance():MapDataManager{\n        return MapDataManager._instance\n    }\n\n    onLoad () {\n        if(null===MapDataManager._instance){\n            MapDataManager._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n\n        this.startPos = [];\n        this.m_mapBlockItem = [];\n        this.startPos.push(cc.v2(0,0));\n        this.startPos.push(cc.v2(640,0));\n        let canvas=cc.find(\"Canvas\");\n        this.blockMaps=canvas.getChildByName(\"Game\").getChildByName(\"blockMaps\");\n        \n    }\n\n    getCurPahtList(){\n        var index = 1;\n        if(index >= this.pathList.length){\n            index = this.pathList.length-1;\n        }\n        return this.pathList[index];\n    }\n\n    getCurBlockData(){\n        var index = 1;\n        if(index >= this.mapBlockData.length){\n            index = this.mapBlockData.length-1;\n        }\n        return this.mapBlockData[index];\n    }\n    getCurCannonPoint(){\n        return this.cannonList;\n    }\n    getBlockDataByIndex(index){\n        if( this.mapBlockData[index] != null){\n            return this.mapBlockData[index];\n        }\n        return null;\n    }\n    getPathDataByIndex(index){\n        if(index >= this.pathList[index]!= null ){\n            return this.pathList[index];\n        }\n        return null;\n    }\n\n    async loadData():Promise<void>{\n        let data:cc.JsonAsset=await ResManagerPro.Instance.IE_GetAsset(\"data\",\"mapData\",cc.JsonAsset) as cc.JsonAsset\n        let jsonData=data.json\n        this.cannonList=jsonData._cannonList;\n        this.mapBlockData=jsonData._mapBlockData;\n        this.pathList=jsonData._pathList;\n    }\n\n    async buildBlockMap(index:number,blockMapData:Array<any>){\n        if(this.m_mapBlockItem[index] == null ){\n            this.m_mapBlockItem[index]=[];\n        }\n        \n        for (let j = 0; j < 6; j++) {\n            var y = j*106;\n            if( this.m_mapBlockItem[index][j] == null ){\n                this.m_mapBlockItem[index][j]=[]\n            }\n\n            for (let i = 0; i < 6; i++) {\n                var x = i * 106;\n                \n                var block = null;\n                if( this.m_mapBlockItem[index][j][i] == null ){\n                    block = new cc.Node;\n                    this.blockMaps.addChild(block);\n                }else{\n                    block = this.m_mapBlockItem[index][j][i].node;\n                }\n                block.x = x + 106/2;\n                block.y = -y - 106/2;\n                block.x += this.startPos[index].x;\n                block.y += this.startPos[index].y;\n                \n                var com = block.addComponent(cc.Sprite) as cc.Sprite;\n\n                this.m_mapBlockItem[index][j][i] = com;\n                var name = ''+blockMapData[j][i];\n\n                var blockAtlas = await ResManagerPro.Instance.IE_GetAsset(\"texture\",\"block/block-1\",cc.SpriteAtlas) as cc.SpriteAtlas\n                com.spriteFrame = blockAtlas.getSpriteFrame(name)\n            }\n        }\n    }\n\n    beginCreateMonster(){\n        var index = 0;\n        var list = this.getCurPahtList();\n        var levelData = DataManager.getInstance().getCurMonsterData();\n        DataManager.getInstance().setCurMonsterCount(levelData.length);\n        var actionList=[];\n        for (let i = 0; i < levelData.length; i++) {\n            var offset = Math.random();\n            var seq = cc.sequence(cc.delayTime(0.2+offset),\n            cc.callFunc(function(){\n                if( index >= levelData.length ){\n                    return;\n                }\n                var speed = levelData[index].speed;\n                var node = this.createMonsterByData(levelData[index],list,speed);\n                \n                index++;\n            }.bind(this)));\n            actionList.push(seq);\n        }\n        var seqList = cc.sequence(actionList);\n        this.node.runAction(seqList);\n    }\n\n    async createMonsterByData(data,list,speed){\n        var type = data.type;\n        var id = data.id;\n        \n        var hp = data.hp;\n        var gold = data.gold;\n        await this.createMonster(type,id,list,hp,gold,speed);\n    }\n    //type 0:小怪物 1:中型怪物 2:boss\n    //index:怪物图片名\n    //起始点\n    async createMonster(type,index,list,hp,gold,speed){\n        gold = gold || 0;\n\n        await ECSManager.getInstance().createMonsterEntity(type,index,list,hp,gold,speed);\n\n        // let enemy = null;\n        // if (this.enemyPool.size() > 0) { // 通过 size 接口判断对象池中是否有空闲的对象\n        //     enemy = this.enemyPool.get();\n        // } else { // 如果没有空闲对象，也就是对象池中备用对象不够时，我们就用 cc.instantiate 重新创建\n        //     enemy = cc.instantiate(this.m_msItemPrefab);\n        // }\n        // enemy.isDead = false;\n        // this.monsterNode.addChild(enemy);\n        // var js = enemy.getComponent('msItem');\n        // js.setImage(type,index);\n        // js.setPath(list);\n        // js.setID(this.m_monsterIndex);\n        // js.setMaxHP(hp);\n        // js.setDeadGold(gold);\n        // this.m_monsterIndex++;\n        // return enemy;\n    }\n}\n"]}