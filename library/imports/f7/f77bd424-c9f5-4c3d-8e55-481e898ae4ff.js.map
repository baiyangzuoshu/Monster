{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\AnimateSystem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { BulletState, UnitState } from \"../../Enum\";\nimport AnimateComponent from \"../Components/AnimateComponent\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport RoleComponent from \"../Components/RoleComponent\";\nimport UnitComponent from \"../Components/UnitComponent\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class AnimateSystem extends cc.Component {\n\n    private static _instance:AnimateSystem=null\n    public static getInstance():AnimateSystem{\n        return AnimateSystem._instance\n    }\n\n    onLoad () {\n        if(null===AnimateSystem._instance){\n            AnimateSystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    onMonsterUpdate(dt,baseComponent:BaseComponent,roleComponent:RoleComponent,animateComponent:AnimateComponent) {\n        if(animateComponent.playActionTime>0){\n            animateComponent.playActionTime-=dt;\n            return;\n        }\n        \n        if( roleComponent.type > 0 ){\n            animateComponent.playActionTime=1;\n\n            var moveScale1 = cc.scaleTo(0.5,1.1,0.9);\n            var moveScale2 = cc.scaleTo(0.5,0.9,1.1);\n            var seqMoveScale = cc.sequence(moveScale1,moveScale2);\n    \n            baseComponent.gameObject.runAction(seqMoveScale);\n        }else{\n            animateComponent.playActionTime=0.4;\n\n            var jump1 = cc.moveBy(0.2,cc.v2(0,30));\n            var jump2 = cc.moveBy(0.2,cc.v2(0,-30));\n            var seqJump = cc.sequence(jump1,jump2);\n\n            baseComponent.gameObject.runAction(seqJump);\n        }\n    }\n\n    onBulletUpdate(dt:number,baseComponent:BaseComponent,animateComponent:AnimateComponent){\n        if(BulletState.Effect!=animateComponent.state){\n            return;\n        }\n\n        animateComponent.playActionTime-=dt;\n\n        if(animateComponent.playActionTime<0){\n            animateComponent.state=BulletState.Attack;\n            let bullet = baseComponent.gameObject.getChildByName('bullet');\n            let effect =baseComponent.gameObject.getChildByName('effect');\n            effect.active = false;\n            bullet.active = true;\n            return;\n        }\n        \n        let effect = baseComponent.gameObject.getChildByName('effect');\n        let bullet = baseComponent.gameObject.getChildByName('bullet');\n        let effectAnimate = effect.getComponent(cc.Animation);\n        effect.active = true;\n        bullet.active = false;\n        effectAnimate.play('fire');\n    }\n\n    onEffectUpdate(dt:number,baseComponent:BaseComponent,animateComponent:AnimateComponent,unitComponent:UnitComponent){\n        if(unitComponent.isDead){\n            return;\n        }\n\n        animateComponent.playActionTime-=dt;\n\n        if(animateComponent.playActionTime<0){\n            unitComponent.isDead=true;\n            return;\n        }\n\n        if(unitComponent.state==UnitState.None){\n            var anim = baseComponent.gameObject.getComponent(cc.Animation);\n            anim.play('deadEffect');\n            unitComponent.state=UnitState.Active;\n        }\n    }\n}\n"]}