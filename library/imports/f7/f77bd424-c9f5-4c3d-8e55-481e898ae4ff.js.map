{"version":3,"sources":["assets\\Scripts\\ECS\\Systems\\AnimateSystem.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { BulletState, UnitState } from \"../../Enum\";\nimport AnimateComponent from \"../Components/AnimateComponent\";\nimport AttackComponent from \"../Components/AttackComponent\";\nimport BaseComponent from \"../Components/BaseComponent\";\nimport RoleComponent from \"../Components/RoleComponent\";\nimport UnitComponent from \"../Components/UnitComponent\";\nimport ECSManager from \"../ECSManager\";\nimport AttackSystem from \"./AttackSystem\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class AnimateSystem extends cc.Component {\n\n    private static _instance:AnimateSystem=null\n    public static getInstance():AnimateSystem{\n        return AnimateSystem._instance\n    }\n\n    onLoad () {\n        if(null===AnimateSystem._instance){\n            AnimateSystem._instance=this\n        }\n        else{\n            this.destroy()\n            return\n        }\n    }\n\n    onMonsterUpdate(dt,baseComponent:BaseComponent,roleComponent:RoleComponent,animateComponent:AnimateComponent) {\n        if(animateComponent.playActionTime>0){\n            animateComponent.playActionTime-=dt;\n            return;\n        }\n        \n        if( roleComponent.type > 0 ){\n            animateComponent.playActionTime=1;\n\n            var moveScale1 = cc.scaleTo(0.5,1.1,0.9);\n            var moveScale2 = cc.scaleTo(0.5,0.9,1.1);\n            var seqMoveScale = cc.sequence(moveScale1,moveScale2);\n    \n            baseComponent.gameObject.runAction(seqMoveScale);\n        }else{\n            animateComponent.playActionTime=0.4;\n\n            var jump1 = cc.moveBy(0.2,cc.v2(0,30));\n            var jump2 = cc.moveBy(0.2,cc.v2(0,-30));\n            var seqJump = cc.sequence(jump1,jump2);\n\n            baseComponent.gameObject.runAction(seqJump);\n        }\n    }\n\n    onBulletUpdate(dt:number,bulletAttackComponent:AttackComponent,bulletBaseComponent:BaseComponent,bulletAnimateComponent:AnimateComponent,bulletUnitComponent:UnitComponent,bulletRoleComponent:RoleComponent){\n        if(BulletState.Effect!=bulletAnimateComponent.state){\n            return;\n        }\n\n        bulletAnimateComponent.playActionTime-=dt;\n\n        if(bulletAnimateComponent.playActionTime<0){\n            bulletAnimateComponent.state=BulletState.Attack;\n            bulletUnitComponent.state=UnitState.Active;\n            let bullet = bulletBaseComponent.gameObject.getChildByName('bullet');\n            let effect =bulletBaseComponent.gameObject.getChildByName('effect');\n            effect.active = false;\n            bullet.active = true;\n            if(1==bulletRoleComponent.type){//闪电炮\n                cc.tween(bullet)\n                .delay(0.1)\n                .call(()=>{\n                    bulletUnitComponent.isDead=true;\n                    let monsterEntity=ECSManager.getInstance().getMonsterById(bulletUnitComponent.monsterID);\n\n                    if(null==monsterEntity){\n                        return;\n                    }\n\n                    let monsterUnitComponent=monsterEntity.unitComponent;\n                    let monsterBaseComponent=monsterEntity.baseComponent;\n                    let monsterAttackComponent=monsterEntity.attackComponent;\n                    let atk=bulletAttackComponent.atk;\n                    AttackSystem.getInstance().attackStartAction(atk,bulletUnitComponent,monsterUnitComponent,monsterBaseComponent,monsterAttackComponent);\n                })\n                .start();\n            }\n            \n            return;\n        }\n        \n        let effect = bulletBaseComponent.gameObject.getChildByName('effect');\n        let bullet = bulletBaseComponent.gameObject.getChildByName('bullet');\n        let effectAnimate = effect.getComponent(cc.Animation);\n        effect.active = true;\n        bullet.active = false;\n        effectAnimate.play('fire');\n    }\n\n    onEffectUpdate(dt:number,baseComponent:BaseComponent,animateComponent:AnimateComponent,unitComponent:UnitComponent){\n        if(unitComponent.isDead){\n            return;\n        }\n\n        animateComponent.playActionTime-=dt;\n\n        if(animateComponent.playActionTime<0){\n            unitComponent.isDead=true;\n            return;\n        }\n\n        if(unitComponent.state==UnitState.None){\n            var anim = baseComponent.gameObject.getComponent(cc.Animation);\n            anim.play('deadEffect');\n            unitComponent.state=UnitState.Active;\n        }\n    }\n}\n"]}