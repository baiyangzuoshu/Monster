{"version":3,"sources":["assets\\Scripts\\UI\\TaskItemControl.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/typescript.html\n// Learn Attribute:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - https://docs.cocos.com/creator/2.4/manual/en/scripting/life-cycle-callbacks.html\n\nimport { UIControl } from \"../../FrameWork/ui/UIControl\";\nimport TaskDataManager from \"../data/TaskDataManager\";\nimport PlayerDataManager from \"../Manager/PlayerDataManager\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class TaskItemControl extends UIControl {\n    m_title:cc.Label=null;\n    m_curLabel:cc.Label=null;\n    m_progressBar:cc.ProgressBar=null;\n    m_awardLabl:cc.Label=null;\n    m_getButton:cc.Button=null;\n    m_awardCoin:cc.Node=null;\n    m_awardDiamond:cc.Node=null;\n    m_taskID:number=0;\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        super.onLoad();\n        this.m_title=this.getChildByUrl(\"item/title\").getComponent(cc.Label);\n        this.m_curLabel=this.getChildByUrl(\"item/curLabel\").getComponent(cc.Label);\n        this.m_progressBar=this.getChildByUrl(\"item/progressBar\").getComponent(cc.ProgressBar);\n        this.m_awardLabl=this.getChildByUrl(\"item/ui_win_numbg_rect/award\").getComponent(cc.Label);\n        this.m_getButton=this.getChildByUrl(\"item/get\").getComponent(cc.Button);\n        this.m_awardCoin=this.getChildByUrl(\"item/ui_win_numbg_rect/ui_coin\");\n        this.m_awardDiamond=this.getChildByUrl(\"item/ui_win_numbg_rect/ui_diamond\");\n\n        this.buttonAddClickEvent(\"item/get\",this.onClickGet,this);\n    }\n\n    setTaskID(taskID){\n        this.m_taskID = taskID;\n    }\n\n    updateItem(){\n        this.m_getButton.interactable = false;\n        var data = TaskDataManager.getInstance().getData();\n        var taskData=TaskDataManager.getInstance().getTaskDataByID(this.m_taskID);\n        if( this.m_taskID >= data.length ){\n            return;\n        }\n        var curTaskData = PlayerDataManager.getInstance().getTaskByID(this.m_taskID);\n        var title = TaskDataManager.getInstance().getTitle(this.m_taskID,curTaskData.maxIndex);\n        this.m_title.string = title;\n\n        var maxCount = TaskDataManager.getInstance().getMaxCount(this.m_taskID,curTaskData.maxIndex);\n        \n        if( curTaskData.curCount >= maxCount){\n            curTaskData.curCount = maxCount;\n            this.m_getButton.interactable = true;\n        }\n\n        var curLabel = ''+ curTaskData.curCount + '/'+maxCount;\n        this.m_curLabel.string = curLabel;\n        var pre = curTaskData.curCount/maxCount;\n        this.m_progressBar.progress = pre;\n\n        if( taskData.taskType == 0 ){\n            this.m_awardCoin.active = true;\n            this.m_awardDiamond.active = false;\n        }else{\n            this.m_awardCoin.active = false;\n            this.m_awardDiamond.active = true;\n        }\n\n        this.m_awardLabl.string=TaskDataManager.getInstance().getAward(this.m_taskID,curTaskData.maxIndex);\n    }\n\n    goldFlyEnd(gold){\n        PlayerDataManager.getInstance().addGold(gold);\n        //g_gameUI.updateGameUI();\n    }\n\n    diamondFlyEnd(diamond){\n        PlayerDataManager.getInstance().addDiamond(diamond);\n        //g_gameUI.updateGameUI();\n    }\n    \n    onClickGet(){\n        \n        var curTaskData = PlayerDataManager.getInstance().getTaskByID(this.m_taskID);\n        var award =TaskDataManager.getInstance().getAward(this.m_taskID,curTaskData.maxIndex);\n        var taskData=TaskDataManager.getInstance().getTaskDataByID(this.m_taskID);\n        var count = 50;\n        var createFly = function(){\n            if( taskData.taskType == 0 ){\n                var value = Math.floor(award/count) ;\n                //g_coinFly.createCoinToTip(this.m_awardCoin,this.goldFlyEnd.bind(this),value,g_gameUI.m_coinFlyNode);\n            }\n            if( taskData.taskType == 1 ){\n                var value = Math.floor(award/count) ;\n                //g_diamondFly.createDiamondToTip(this.m_awardCoin,this.diamondFlyEnd.bind(this),value,g_gameUI.m_coinFlyNode);\n            }\n        }\n        var actionList=[]\n        // actionList.push(cc.delayTime(1));\n        if( award < count ){\n            count = award;\n        }\n        for (let i = 0; i < count; i++) {\n            actionList.push(cc.delayTime(0.01));\n            actionList.push(cc.callFunc(createFly.bind(this)));\n        }\n        actionList.push(cc.callFunc(function(){\n            if( taskData.taskType == 0 ){\n                PlayerDataManager.getInstance().setGold(award);\n            }else{\n                PlayerDataManager.getInstance().setDiamond(award);\n            }\n            //g_gameUI.updateGameUI();\n        }.bind(this)))\n        this.node.runAction(cc.sequence(actionList));\n\n        PlayerDataManager.getInstance().nextTask(this.m_taskID);\n        this.updateItem();\n    }\n}\n"]}